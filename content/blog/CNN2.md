---
title: Exploring Architectures- CNN II
description: It just got more <i>convoluted</i>
---

## Building upto: Backpropagation

With our loss function defined in the <a href="/blog/cnn/">previous</a> essay, we arrive at perhaps the most important and complex part of the network (any network that is), backpropagation. We start by doing a small recap of all the operations we have done to get to our probability distribution, and put that in our loss function. As a starting point, let's define an operation to denote a convolution, and ounce again follow the entire process (bit lenghty, but helps for revision).

<math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>o</mi><mi>l</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><mi>𝐈</mi><mo>⊗</mo><mi>𝐊</mi><mtext> </mtext><mo lspace="0.2222em" rspace="0em">:</mo><mo lspace="0em">=</mo><mtext> </mtext><mi>𝐂</mi></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>i</mi><mn>1,1</mn></msub></mtd><mtd><msub><mi>i</mi><mn>1,2</mn></msub></mtd><mtd><msub><mi>i</mi><mn>1,3</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>i</mi><mn>1,20</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>i</mi><mn>2,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>i</mi><mn>3,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>i</mi><mn>20,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><msub><mi>i</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>20</mn><mo>* </mo><mn>20</mn></mrow></msub><mo>⊗</mo><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>k</mi><mn>11</mn></msub></mtd><mtd><msub><mi>k</mi><mn>12</mn></msub></mtd><mtd style="padding-right:0em;"><msub><mi>k</mi><mn>13</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>k</mi><mn>21</mn></msub></mtd><mtd><msub><mi>k</mi><mn>22</mn></msub></mtd><mtd style="padding-right:0em;"><msub><mi>k</mi><mn>23</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>k</mi><mn>31</mn></msub></mtd><mtd><msub><mi>k</mi><mn>32</mn></msub></mtd><mtd style="padding-right:0em;"><msub><mi>k</mi><mn>33</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>3</mn><mo>* </mo><mn>3</mn></mrow></msub><mo lspace="0.2222em" rspace="0em">:</mo><mo lspace="0em">=</mo><mtext> </mtext><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>1,1</mn></msub></mtd><mtd><msub><mi>c</mi><mn>1,2</mn></msub></mtd><mtd><msub><mi>c</mi><mn>1,3</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mn>1,20</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>2,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>3,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>20,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>20</mn><mo>* </mo><mn>20</mn></mrow></msub></mrow></mtd></mtr></mtable></math><br><math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>F</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><mi>𝐂</mi><mo stretchy="false">→</mo><msub><mi>𝐂</mi><mi>F</mi></msub></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mtext> </mtext><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>1,1</mn></msub></mtd><mtd><msub><mi>c</mi><mn>1,2</mn></msub></mtd><mtd><msub><mi>c</mi><mn>1,3</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mn>1,20</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>2,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>3,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>20,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>20</mn><mo>* </mo><mn>20</mn></mrow></msub><mo stretchy="false">→</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>20</mn></mrow><mi>T</mi></msubsup></mrow></mtd></mtr></mtable></math><br><math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>F</mi><mi>o</mi><mi>r</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>a</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>I</mi><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><msub><mi>𝐂</mi><mi>F</mi></msub><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>=</mo><msub><mi>𝐎</mi><mn>1</mn></msub></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>c</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>20</mn></mrow><mi>T</mi></msubsup><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>1,1</mn></msub></mtd><mtd><msub><mi>w</mi><mn>12</mn></msub></mtd><mtd><msub><mi>w</mi><mn>13</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>w</mi><mrow><mn>1</mn><mi>m</mi></mrow></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>2,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>3,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>20,1</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><msub><mi>w</mi><mrow><mi>n</mi><mi>m</mi></mrow></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>20</mn><mo>* </mo><mi>m</mi></mrow></msub><mo>+</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup><mo>=</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup></mrow></mtd></mtr></mtable></math><br><math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><mi>R</mi><mi>e</mi><mi>L</mi><mi>u</mi><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><msub><mi>𝐎</mi><mn>1</mn></msub><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>=</mo><mtext> </mtext><mi>𝐇</mi></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence="true" form="prefix">(</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup><mo>+</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>|</mi><msub><mi>o</mi><mn>1,1</mn></msub><mi>|</mi></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>|</mi><msub><mi>o</mi><mn>1,2</mn></msub><mi>|</mi></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>|</mi><msub><mi>o</mi><mn>1,3</mn></msub><mi>|</mi></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>|</mi><msub><mi>o</mi><mn>20,20</mn></msub><mi>|</mi></mrow></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup><mo fence="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup></mrow></mtd></mtr></mtable></math><br>
<math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>F</mi><mi>o</mi><mi>r</mi><mi>w</mi><mi>a</mi><mi>r</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>a</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>I</mi><mi>I</mi><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><mi>𝐇</mi><mo>* </mo><msub><mi>𝐖</mi><mn>2</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>2</mn></msub><mo>=</mo><msub><mi>𝐎</mi><mn>2</mn></msub></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,1</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,2</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>1,3</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>h</mi><mn>20,20</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mi>m</mi></mrow><mi>T</mi></msubsup><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>11</mn></msub></mtd><mtd><msub><mi>w</mi><mn>12</mn></msub></mtd><mtd style="padding-right:0em;"><msub><mi>w</mi><mn>13</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>21</mn></msub></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mn>31</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mrow></mrow></mtd><mtd style="padding-right:0em;"><mrow></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>w</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mtd><mtd><msub><mi>w</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mtd><mtd style="padding-right:0em;"><msub><mi>w</mi><mrow><mi>m</mi><mn>3</mn></mrow></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mi>m</mi><mo>* </mo><mn>3</mn></mrow></msub><mo>+</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>11</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>b</mi><mn>13</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>3</mn></mrow><mi>T</mi></msubsup><mo>=</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>11</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>13</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>3</mn></mrow><mi>T</mi></msubsup></mrow></mtd></mtr></mtable></math><br>
<math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mo lspace="0.2222em" rspace="0.2222em">:</mo><mtext> </mtext><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo form="prefix" stretchy="false">(</mo><msub><mi>𝐎</mi><mn>2</mn></msub><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>=</mo><mtext> </mtext><msup><mi>P</mi><mo lspace="0em" rspace="0em">* </mo></msup><mo form="prefix" stretchy="false">(</mo><mi>y</mi><mi>|</mi><mi>x</mi><mo separator="true">;</mo><mi>θ</mi><mo form="postfix" stretchy="false">)</mo></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mo separator="true">,</mo><mtext> </mtext><mi>θ</mi><mtext> </mtext><mo>=</mo><mtext> </mtext><mo form="prefix" stretchy="false">{</mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>𝐖</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>𝐁</mi><mn>𝟏</mn></msub><mo separator="true">,</mo><msub><mi>𝐁</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">}</mo></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>σ</mi><mrow><mo fence="true" form="prefix">(</mo><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>11</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><msub><mi>o</mi><mn>13</mn></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>3</mn></mrow><mi>T</mi></msubsup><mo fence="true" form="postfix">)</mo></mrow><mtext> </mtext><mo>=</mo><mtext> </mtext><msubsup><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><mfrac><msup><mi>e</mi><msub><mi>o</mi><mn>11</mn></msub></msup><mrow><msubsup><mo movablelimits="false">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>3</mn></msubsup><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup></mrow></mfrac></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mfrac><msup><mi>e</mi><msub><mi>o</mi><mn>12</mn></msub></msup><mrow><msubsup><mo movablelimits="false">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>3</mn></msubsup><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup></mrow></mfrac></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mfrac><msup><mi>e</mi><msub><mi>o</mi><mn>13</mn></msub></msup><mrow><msubsup><mo movablelimits="false">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>3</mn></msubsup><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup></mrow></mfrac></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mn>1</mn><mo>* </mo><mn>3</mn></mrow><mi>T</mi></msubsup></mrow></mtd></mtr></mtable></math>

In the last layer, the various parameters that 𝜃 represents are simply the weights, biases and the kernel. Parameters are objects (matrices and vectors in our case) that our model used in order to arrive at the probability distribution and the ones it is allowed to tweak and adjust. The only other variables are the input and the output, which we provide and which can't be tampered with, hence they are always constant. For the ease of backpropagation, let's pull the variables in the loss function. 

<math display="block" class="tml-display" style="display:block math;"><mrow><mo>−</mo><mrow><munder><mo movablelimits="false">∑</mo><mi>i</mi></munder></mrow><mi>P</mi><mo form="prefix" stretchy="false">(</mo><mi>y</mi><mi>|</mi><msub><mi>x</mi><mi>i</mi></msub><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo fence="true" form="prefix">(</mo><msup><mi>P</mi><mo lspace="0em" rspace="0em">*</mo></msup><mo form="prefix" stretchy="false">(</mo><mi>y</mi><mi>|</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">;</mo><mi>θ</mi><mo form="postfix" stretchy="false">)</mo><mo fence="true" form="postfix">)</mo></mrow><mo form="postfix" stretchy="false">)</mo></mrow></math>

This is the cross entropy loss. With the input layer *I* which is the image, we utilize the parameters **W**<sub>1</sub>,**W**<sub>2</sub>,**B**<sub>1</sub>,**B**<sub>2</sub> and **K** to calculate a certain probability distribution or at least our model's initial guess at the true distribution *T*. After that we simply check how wrong it was by using the cross entropy loss. Here : <strong>*P*<sup> * </sup>( *y* | *x* ; 𝜃)</strong>  is the probability that our model came up with using the parameters, and <strong>*P*(*y*|*x*)</strong> is the true probability or *T*.

<img src='/media/CNNeq.png'>

<math display="block" class="tml-display" style="display:block math;"><mrow><mi>P</mi><mo form="prefix" stretchy="false">(</mo><mi>y</mi><mi>|</mi><mi>x</mi><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>=</mo><mtext> </mtext><mi>T</mi></mrow></math><br>

<math display="block" class="tml-display" style="display:block math;"><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>−</mo><mo movablelimits="false">∑</mo><mi>T</mi><mi>.</mi><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo fence="true" form="prefix">(</mo><mfrac><msup><mi>e</mi><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mi>|</mi><mo fence="true" form="postfix">)</mo></mrow><mo>* </mo><msub><mi>𝐖</mi><mn>2</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>2</mn></msub><mo fence="true" form="postfix">)</mo></mrow></msup><mrow><msub><mo movablelimits="false">∑</mo><mi>i</mi></msub><msup><mi>e</mi><msub><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><msub><mi>i</mi><mi>i</mi></msub><mtext> </mtext><mo>⊗</mo><mtext> </mtext><msub><mi>k</mi><mi>i</mi></msub><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><mi>|</mi><mo form="prefix" stretchy="false">(</mo><msub><mi>i</mi><mi>i</mi></msub><mtext> </mtext><mo>⊗</mo><mtext> </mtext><msub><mi>k</mi><mi>i</mi></msub><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mi>|</mi><mo fence="true" form="postfix">)</mo></mrow><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub><mo fence="true" form="postfix">)</mo></mrow><mi>i</mi></msub></msup></mrow></mfrac><mo fence="true" form="postfix">)</mo></mrow></mrow></math>

The above loss function is made up of: input **I** and output **T**, which cannot be tampered with and are constants, and parameters which the model must modify and tweak, in order to bring down the overall loss function (**W**<sub>1</sub>,**W**<sub>2</sub>,**B**<sub>1</sub>,**B**<sub>2</sub> and **K**). The reason the above equation looks so complicated is due to the fact that I put each and every variable in terms of either the input or one of the parameters. It need not be so complicated, but since mathematical theory requires it (and it's fun as well), I tried my best. Perhaps the most difficult part is yet to come: we must find the derivative of the loss function with respect to each of the parameters, in order to perform gradient descent optimization.

## Backpropagation

As discussed in previous essays, the above derived loss function must be minimized. But how ? In order to answer that question, we must remember how it was formed in the first place: through the use of certain parameters (mathematical objects of our/model's desire) and real world data that we obtained (**I** and **T** for input and the actual true values of the output). We adjust the parameters after every iteration in such a way that it minimizes the loss function. By how much should be change the parameters? By the loss's derivative with respect to the parameters. This is one of the most important optimization algorithms in deep learning, known as gradient descent optimization. (For further details, read my previous essay<a href="/blog/nnla/">here</a>).

For us to solve the various gradients with respect to our inputs by hand is already a very tedious task: as we have an already very complex loss function with multiple inputs. But nevertheless, I have broken down the equation into various parts and constructed a computational graph for the same, where we can more easily see what's happening under the hood and also easily calculate derivatives of more simpler functions and than to pile them up. First we start by assigning sub-variables and creating what we call a computational graph (I would highly recommend reading<a href="/blog/autograd/">this</a> essay before going on, as it will make things crystal clear).

<img src='/media/graph.png'>

Thus we have formed our graph, with each sub-variable repesenting an operation performed on our original parameters or Input in order to reach our output. This view is much simpler, and makes it easier to get to the next step, where we want to calculate each variable's gradient with respect to the variable that were used in creating it. Before that, let's view notationaly what we want: the derivative of the Loss function with respect to **W**<sub>1</sub>, **B**<sub>1</sub>, **W**<sub>2</sub>, **B**<sub>2</sub>, **K**.

<math display="block" class="tml-display" style="display:block math;"><mrow><mfrac><mrow><mi>δ</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>2</mn></msub></mrow></mfrac><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>2</mn></msub></mrow></mfrac><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>1</mn></msub></mrow></mfrac><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>1</mn></msub></mrow></mfrac><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi>δ</mi><mi>𝐊</mi></mrow></mfrac></mrow></math>

In order to get to these, we just need to traverse the graph backwards and get to the final output, hence backpropagation. Since the values are too complex, I have first calculated the indivisual gradients of sub-variables as follows: 

<math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mo>=</mo><mo>−</mo><mi>i</mi><mi>𝐓</mi><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mo movablelimits="false">∑</mo><mi>i</mi></msub><msup><mi>e</mi><msub><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>i</mi><mtext> </mtext><mo>⊗</mo><mtext> </mtext><mi>k</mi><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>i</mi><mtext> </mtext><mo>⊗</mo><mtext> </mtext><mi>k</mi><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>*</mo><mtext> </mtext><msub><mi>w</mi><mn>1</mn></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo><mo fence="true" form="postfix">)</mo></mrow><mtext> </mtext><mo>*</mo><mtext> </mtext><msub><mi>w</mi><mn>2</mn></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mn>2</mn></msub><mo fence="true" form="postfix">)</mo></mrow><mi>i</mi></msub></msup></mrow><msup><mi>e</mi><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo><mo fence="true" form="postfix">)</mo></mrow><mo>* </mo><msub><mi>𝐖</mi><mn>2</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>2</mn></msub><mo fence="true" form="postfix">)</mo></mrow></msup></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mo>=</mo><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center"><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><msub><mi>𝐎</mi><mn>1</mn></msub><mo>−</mo><msub><mi>𝐎</mi><mn>1</mn></msub><mi>.</mi><msubsup><mi>𝐎</mi><mn>1</mn><mi>T</mi></msubsup><mo>−</mo><msub><mo movablelimits="false">∑</mo><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mi>j</mi></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>j</mi><mo>≠</mo><mn>1</mn></mrow></mtd></mtr></mtable></msub><msub><mi>𝐎</mi><mn>1</mn></msub><mi>.</mi><msub><mi>𝐎</mi><mi>j</mi></msub></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><msub><mi>𝐎</mi><mn>2</mn></msub><mo>−</mo><msub><mi>𝐎</mi><mn>2</mn></msub><mi>.</mi><msubsup><mi>𝐎</mi><mn>2</mn><mi>T</mi></msubsup><mo>−</mo><msub><mo movablelimits="false">∑</mo><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mi>j</mi></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>j</mi><mo>≠</mo><mn>2</mn></mrow></mtd></mtr></mtable></msub><msub><mi>𝐎</mi><mn>2</mn></msub><mi>.</mi><msub><mi>𝐎</mi><mi>j</mi></msub></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;padding-right:0em;"><mrow><msub><mi>𝐎</mi><mi>i</mi></msub><mo>−</mo><msub><mi>𝐎</mi><mi>i</mi></msub><mi>.</mi><msubsup><mi>𝐎</mi><mi>i</mi><mi>T</mi></msubsup><mo>−</mo><msub><mo movablelimits="false">∑</mo><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mi>j</mi></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mi>j</mi><mo>≠</mo><mi>i</mi></mrow></mtd></mtr></mtable></msub><msub><mi>𝐎</mi><mi>i</mi></msub><mi>.</mi><msub><mi>𝐎</mi><mi>j</mi></msub></mrow></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mtext> </mtext><mo separator="true">,</mo><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mtext> </mtext><msub><mi>𝐎</mi><mi>i</mi></msub><mo>=</mo><mfrac><msup><mi>e</mi><msub><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo><mo fence="true" form="postfix">)</mo></mrow><mo>* </mo><msub><mi>𝐖</mi><mn>2</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>2</mn></msub><mo fence="true" form="postfix">)</mo></mrow><mi>i</mi></msub></msup><mrow><msub><mo movablelimits="false">∑</mo><mi>i</mi></msub><msup><mi>e</mi><msub><mrow><mo fence="true" form="prefix">(</mo><mrow><mo fence="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>i</mi><mtext> </mtext><mo>⊗</mo><mtext> </mtext><mi>k</mi><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>i</mi><mtext> </mtext><mo>⊗</mo><mtext> </mtext><mi>k</mi><mo form="postfix" stretchy="false">)</mo><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mn>1</mn></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo><mo fence="true" form="postfix">)</mo></mrow><mtext> </mtext><mo>* </mo><mtext> </mtext><msub><mi>w</mi><mn>2</mn></msub><mtext> </mtext><mo>+</mo><mtext> </mtext><msub><mi>b</mi><mn>2</mn></msub><mo fence="true" form="postfix">)</mo></mrow><mi>i</mi></msub></msup></mrow></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐑</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo form="prefix" stretchy="false">(</mo><mtext> </mtext><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mo>+</mo><mi>|</mi><mo form="prefix" stretchy="false">(</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi><mo form="postfix" stretchy="false">)</mo><mo>* </mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐁</mi><mn>1</mn></msub><mi>|</mi><mo form="postfix" stretchy="false">)</mo></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐂</mi></mrow><mrow><mi>δ</mi><mi>𝐊</mi></mrow></mfrac><mo>=</mo><msub><mrow><mo fence="true" form="prefix">[</mo><mtable columnalign="center center center"><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mn>11</mn></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mtd></mtr><mtr><mtd style="padding-left:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd><mtd><mo lspace="0em" rspace="0em">⋱</mo></mtd><mtd style="padding-right:0em;"><mrow><mi>⋮</mi><mspace width="0pt" height="14.944pt"></mspace></mrow></mtd></mtr><mtr><mtd style="padding-left:0em;"><msub><mi>c</mi><mrow><mi>n</mi><mn>1</mn></mrow></msub></mtd><mtd><mo lspace="0em" rspace="0em">…</mo></mtd><mtd style="padding-right:0em;"><msub><mi>c</mi><mrow><mi>n</mi><mi>n</mi></mrow></msub></mtd></mtr></mtable><mo fence="true" form="postfix">]</mo></mrow><mrow><mi>n</mi><mo>*</mo><mi>n</mi></mrow></msub><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>𝐇</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>1</mn></msub></mrow></mfrac><mo>=</mo><mi>I</mi><mo>⊗</mo><mi>𝐊</mi></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐇</mi></mrow><mrow><mi>δ</mi><mi>𝐂</mi></mrow></mfrac><mo>=</mo><msub><mi>𝐖</mi><mn>1</mn></msub><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><mi>𝐑</mi></mrow></mfrac><mo>=</mo><msub><mi>𝐖</mi><mn>2</mn></msub></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐇</mi></mrow></mfrac><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>1</mn></msub></mrow></mfrac><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐎</mi></mrow></mfrac><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mtext> </mtext><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></math>

And finally, through the chain rule, we get to our final parameter gradients:

<math display="block" class="tml-display" style="display:block math;"><mtable columnalign="left"><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>2</mn></msub></mrow></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐎</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>2</mn></msub></mrow></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>1</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐎</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><mi>𝐑</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐑</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐁</mi><mn>1</mn></msub></mrow></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>1</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐎</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><mi>𝐑</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐑</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐇</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐇</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐖</mi><mn>1</mn></msub></mrow></mfrac></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow></mrow></mtd></mtr><mtr><mtd class="tml-left" style="padding:0.5ex 0em 0.5ex 0em;"><mrow><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><mi>𝐊</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>𝐋</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>L</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>S</mi></msub></mrow><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐎</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐎</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐎</mi></mrow><mrow><mi>δ</mi><mi>𝐑</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐑</mi></mrow><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow></mfrac><mfrac><mrow><mi>δ</mi><msub><mi>𝐇</mi><mi>B</mi></msub></mrow><mrow><mi>δ</mi><mi>𝐇</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐇</mi></mrow><mrow><mi>δ</mi><mi>𝐂</mi></mrow></mfrac><mfrac><mrow><mi>δ</mi><mi>𝐂</mi></mrow><mrow><mi>δ</mi><mi>𝐊</mi></mrow></mfrac></mrow></mtd></mtr></mtable></math>

By substituting the above equations with their actual values, we see that the gradients are indeed quite complex, despite us dealing with a fairly rudimentry network. All that remains is that we change the parameters by their gradients and keep continuing the process until we reach a desired loss level.

Ok. That was a lot of calculations and maths to deal with ! This entire process discussed above and in the previous essay constitutes the convolutional nueral network, which gives computers vision. More sophiticated models are far more complex and larger in their parameter size and numbers (as many might know, chatGPT has 175 *billion* paramters, compared to the measly five we used here). But no model strays too far away from the basic architecture, and hence we always benefit from knowing these architectres inside out. Believe it or not, the entire process above can be acheived in just a few lines of code using certain deep learning framworks (PytTorch or Tensorflow). Anyways, thank you for reading this far!

<p style="text-align: center;">
<strong><a href='/'>Home</a></strong>
</p>